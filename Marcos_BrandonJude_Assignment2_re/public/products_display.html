<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Store</title>
    <script src="/product_data.js"></script>
    <link rel="stylesheet" href="./products_styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
</head>

<!-- This file will load the order page with product data and prices -->

<style>
    html,
    body {
        background-image: linear-gradient(to top, #92c8fa, white);
        height: 100%;
    }


    ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #2371DC;
    }

    li {
        float: left;
    }

    li a {
        font-family: 'Montserrat', sans-serif;
        display: block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
    }

    li a:hover {
        background-color: #739fde;
    }

    #login_button,
    #logout_button,
    #shopping_cart {
        float: right;
    }
</style>

<script>

    let params = (new URL(document.location)).searchParams;
    if (params.has('prod_key')) {
        var product_type = params.get('prod_key');
    } else {
        alert('Must have a product key to display products!');
        window.stop;
    }
</script>

<script>
    //when the page loads, check the URL for existence of paramters
    window.onload = function () {

        let params = (new URL(document.location)).searchParams;
        product_form = params.get('product');
        //if the alert parameter exists, load an alert on the client browser
        if (params.has("alert_error")) {
            alert(params.get("alert_error"));
        }
        else {
            if (params.has("errors")) {
                document.getElementsByName(`quantity_textbox_of_${params.get('product_name')}`).value = params.get(`quantity_textbox_of_${params.get('product_name')}`);
                    console.log(params.get(`errors['quantity_error']`));
                    alert(params.get(`errors['quantity_error']`));
                }
            }
        }

        function navigationbar() {

            document.write(`
        <div id="nav">
            <ul>`);

            for (p_key in products_array) {
                document.write(`
            <li><a href="./products_display.html?prod_key=${p_key}">${p_key}</a></li>

        `);
            }

            document.write(`

        <li id="shopping_cart" class="shopping_cart"><a href="./shopping_cart.html">Cart</a></li>
        <li id="login_button" class="login_button"><a href="./login.html">Login</a></li>
        <li id="logout_button" class="logout_button"><a href="/logout">Logout</a></li>

        </ul>
        `);

        }








</script>


<body>

    <div class="header_container">
        <h1>Brandon's Premium Fruit Store</h1>
    </div>

    <script type="text/javascript">navigationbar();</script>

    <div class="welcome_container">
        <h3>Welcome! Shop below for the products fruit on Earth!</h3>
    </div>

    <br>
    <br>


    <!-- Iterate through each product from the JSON products file and create its section on the order page -->

    <script>


            // product_key as a hidden input so server can get products_array quantity
            document.write(`<input type="hidden" name="product_type" value="${product_type}">`);
            //setting up the form with for statement
            //load the product information into the order page with for loop
            document.write(`<div class="item_container">`)
            for (i = 0; i < products_array[product_type].length; i++) {
                document.write(`
                    <div class="item">
                        <form name="product_${i}" action="/add_to_cart" method="post">
                        <img class="item_image" src="${products_array[product_type][i].image}">
                        <p class="item_name">${products_array[product_type][i].name}</p>
                        <p class="item_price">$${products_array[product_type][i].price}</p>
                        <label for="quantity_input">Qty</label>
                        <input type="text" value="0" name="quantity_textbox_of_${products_array[product_type][i].name}"></input>
                        <p>In Stock: ${products_array[product_type][i].quantity_available}</p>
                        <input type="hidden" name="product" value="product_${i}">
                        <input type="hidden" name="product_type" value="${product_type}">
                        <input type="hidden" name="product_name" value="${products_array[product_type][i].name}">
                        <input type="submit" name="submit_button" value="Add to Cart">
                    </form>

                    </div>
                
                </div>

                `);
            }


    </script>




</body>

</html>